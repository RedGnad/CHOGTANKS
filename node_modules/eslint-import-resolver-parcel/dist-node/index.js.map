{"version":3,"file":"index.js","sources":["../dist-src/index.js"],"sourcesContent":["import path from 'path';\nimport fs from 'fs';\nimport { isCore, sync as resolveSync } from 'resolve';\nconst defaultExtensions = ['.js', '.jsx'];\nexport const interfaceVersion = 2;\n\nfunction findAliases() {\n  let currentPath = path.resolve();\n  let packagePath = path.resolve(currentPath, 'package.json');\n\n  while (!fs.existsSync(packagePath)) {\n    currentPath = path.resolve(currentPath, '..');\n    packagePath = path.resolve(currentPath, 'package.json');\n  }\n\n  const packageJson = fs.readFileSync(packagePath);\n  return JSON.parse(packageJson).alias || {};\n}\n\nfunction resolvePackageLevel(source, file, rootDirectory) {\n  let packageDirectory = path.dirname(file);\n\n  for (;;) {\n    if (fs.existsSync(path.resolve(packageDirectory, 'node_modules'))) {\n      // found node_modules\n      break;\n    } else if (path.parse(packageDirectory).root === packageDirectory) {\n      // reached the drive root, just return null\n      return null;\n    }\n\n    packageDirectory = path.resolve(packageDirectory, '..');\n  }\n\n  return path.join( // return rootDirectory if it is nested inside the packageDirectory\n  rootDirectory.startsWith(packageDirectory) ? rootDirectory : packageDirectory, // Get rid of the tilde\n  source.slice(1));\n}\n\nexport function resolve(source, file, possibleConfig = {}) {\n  if (isCore(source)) return {\n    found: true,\n    path: null\n  };\n  const config = {\n    rootDir: '',\n    extensions: [],\n    ...possibleConfig\n  };\n  const [startSource] = source.split('/');\n  const aliases = findAliases();\n  const foundAlias = Object.keys(aliases).find(alias => alias === startSource);\n  let newSource = source.replace(foundAlias, aliases[foundAlias]);\n  const rootDirectory = path.resolve(config.rootDir);\n\n  switch (newSource[0]) {\n    case '.':\n      newSource = path.resolve(path.dirname(file), newSource);\n      break;\n\n    case '~':\n      newSource = resolvePackageLevel(newSource, file, rootDirectory);\n      break;\n\n    case '/':\n      newSource = path.join(rootDirectory, newSource);\n      break;\n    // no default\n  }\n\n  try {\n    return {\n      found: true,\n      path: resolveSync(newSource, {\n        basedir: path.resolve(),\n        extensions: [...defaultExtensions, ...config.extensions]\n      })\n    };\n  } catch (_) {\n    return {\n      found: false\n    };\n  }\n}"],"names":["defaultExtensions","interfaceVersion","findAliases","currentPath","path","resolve","packagePath","fs","existsSync","packageJson","readFileSync","JSON","parse","alias","resolvePackageLevel","source","file","rootDirectory","packageDirectory","dirname","root","join","startsWith","slice","possibleConfig","isCore","found","config","rootDir","extensions","startSource","split","aliases","foundAlias","Object","keys","find","newSource","replace","resolveSync","basedir","_"],"mappings":"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"}